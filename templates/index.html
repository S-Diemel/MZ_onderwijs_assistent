<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>RIF Chatbot</title>
    <style>
        :root {
          --bg: #f7f7f8;
          --header: #ffffff;
          --user-bg: #bae0f3;
          --assistant-bg: #ffffff;
          --assistant-bg-hover: #f0f4f8;
          --border: #e0e0e0;
          --text-color: #333;
          --accent: #1BB5CA;
        }
        * { box-sizing: border-box; }
        body {
          margin: 0;
          font-family: sans-serif;
          background: var(--bg);
          display: flex;
          flex-direction: column;
          height: 100vh;
        }
        header {
          background: var(--header);
          padding: 0.5rem 1rem;
          box-shadow: 0 1px 3px rgba(0,0,0,0.1);
          font-size: 1.2rem;
          font-weight: bold;
          color: var(--accent);
          border-bottom: 1px solid var(--border);
        }
        /* Style the reset button */
        #resetBtn {
          position: absolute;
          top: 1.25rem;
          right: 1rem;
          background: var(--accent);
          color: white;
          border: none;
          padding: 0.4rem 0.8rem;
          border-radius: 0.5rem;
          cursor: pointer;
          font-size: 1.2rem;
        }
        #resetBtn:hover {
          filter: brightness(0.95);
        }
        /* Container for sources + chat */
        .layout {
          flex: 1;               /* fill vertical space below the header */
          display: flex;         /* side-by-side columns */
          overflow: hidden;      /* prevent double scrollbars */
        }

        /* Left column: 25% width */
        .sources {
          flex: 0 0 20%;
          border-right: 1px solid var(--border);
          background: #fafafa;
          padding: 1rem;
          overflow-y: auto;      /* scroll if citations overflow */
        }
        .sources h2 {
          margin: 0 0 0.75rem;
          padding-bottom: 0.5rem;
          font-size: 1.2rem;
          font-weight: bold;
          color: var(--accent);

          /* this draws the line */
          border-bottom: 2px solid var(--accent);
        }
        .sources .citation {
           display: flex;
          justify-content: center;          /* horizontal centering */
          align-items: center;              /* vertical centering */
          width: 90%;                       /* consistent width in the sidebar */
          min-height: 3rem;              /* at least 3rem tall */
          height: auto;                       /* fixed height for all bubbles */
          background: var(--assistant-bg);
          border: 1px solid var(--border);
          border-radius: 0.75rem;
          margin: 0.5rem auto;              /* auto left/right centers in the 25% pane */
          padding: 0.5rem 0.75rem;               /* horizontal padding inside bubble */
          text-align: center;               /* fallback for multiline text */
          font-size: 0.9rem;
          color: var(--text-color);
          white-space: pre-wrap;            /* respect line breaks */
          overflow-wrap: break-word;        /* wrap long URLs or filenames */
          cursor: pointer;               /* show it’s clickable */
          user-select: none;             /* prevent text selection on click */
          transition: background 0.2s;   /* subtle hover feedback */
        }
        .sources .citation:hover {
          background: var(--assistant-bg-hover);
        }
        main.chat-wrapper {
          flex: 1;               /* take remaining width */
          display: flex;
          flex-direction: column;
          padding: 1rem 0 0 0;
          overflow: hidden;
          background: var(--bg) url('/static/Miec zorg.png') no-repeat center center;
          background-size: 300px auto;
        }
        #messages {
          flex: 1;
          overflow-y: auto;
          padding-right: 0.5rem;
        }
        .message {
          width: fit-content;
          max-width: 70%;
          margin: 1.5rem 0;
          padding: 0.75rem 1rem;
          border: 1px solid var(--border);
          border-radius: 0.75rem;
          position: relative;
          line-height: 1.4;
          white-space: pre-wrap;
          overflow-wrap: break-word;
        }
        .message.user {
          margin-left: auto;
          margin-right:  5%;
          background: var(--user-bg);
        }
        .message.assistant,
        .message.assistant.loading {
          max-width: 90%;
          width: 90%;

          margin: 0.5rem auto; /* center horizontally */

          /* ensure text (or spinner) wraps/positions nicely */
          white-space: pre-wrap;
          overflow-wrap: break-word;
          text-align: left;
          background: var(--assistant-bg);
        }
        .message.assistant.loading::after {
          content: "⏳";
          position: absolute;
          bottom: 0.5rem;
          right: 0.75rem;
          animation: spin 1s linear infinite;
        }
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        .input-area {
          display: flex;
          align-items: center;
          border-top: 1px solid var(--border);
          padding: 0.5rem;
          background: #fff;
          position: sticky;
          bottom: 0;
          left: 0;                    /* align to left edge of chat column */
          right: 0;                   /* align to right edge */
          width: auto;
          box-sizing: border-box;     /* include padding in width */
          z-index: 10;
        }
        .input-area textarea {
          flex: 1;
          resize: none;
          padding: 0.75rem;
          border: 1px solid var(--border);
          border-radius: 0.5rem;
          font-size: 1rem;
          line-height: 1.4;
          margin: 0 0.5rem;
          max-height: 150px;
        }
        .input-area button {
          /* make it a fixed-size circle */
          width: 2.5rem;
          height: 2.5rem;
          padding: 0rem;               /* remove the default padding */
          border-radius: 50%;       /* full circle */
          background: var(--accent);
          border: none;
          cursor: pointer;

          /* center any generated content */
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.5rem;
          color: white;
          margin-right: 0.5rem;
        }

        .input-area button:not(:disabled)::before {
          content: "⬆";
          line-height: 1;
        }

        .input-area button:disabled {
          width: 2.5rem;
          height: 2.5rem;
          padding: 0;
          border-radius: 50%;
          background: #ccc;
          border: none;
          cursor: default;
          display: flex;
          align-items: center;
          justify-content: center;
          opacity: 1;
        }

        .input-area button:disabled::before {
          content: "";
          display: block;
          width: 0.75rem;
          height: 0.75rem;
          background-color: black;
        }

        .input-area button:hover {
          filter: brightness(0.95);
        }

        /* Prompt buttons overlay */
        .prompt-buttons {
          position: absolute;
          bottom: 5rem;
          left: 60%;
          transform: translateX(-50%);
          display: grid;
          /* two equal columns so every button is the same width */
          grid-template-columns: repeat(2, 1fr);
          gap: 1rem;
          background: none;
          padding: 0;
          border: none;
          box-shadow: none;
          z-index: 20;
          width: 75%;
        }

        .prompt-buttons button {
          width: 100%;               /* fill the grid cell */
          padding: 0.75rem;
          font-size: 1rem;
          border: 1px solid var(--border);
          border-radius: 0.5rem;
          background: var(--user-bg);
          cursor: pointer;

          /* truncate overflow with ellipsis */
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;

          /* fix the height at one line’s height */
          line-height: 1.2;          /* adjust to match your font-size */
          height: 3em;

          /* allow a smooth height change */
          transition: height 0.2s ease, white-space 0.2s ease;
        }

        .prompt-buttons button:hover {
          height: auto;
          white-space: normal;
          overflow: visible;
          filter: brightness(0.95);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/livekit-client/dist/livekit-client.umd.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

</head>
<body>
<header>
    <img src="/static/Miec Zorg.png" alt="Miec Zorg Logo" style="height:3.5rem; object-fit:contain;" />
    <!-- Reset button -->
    <button id="resetBtn">Reset</button>
</header>

<div class="layout">
    <!-- Left 25%: source citations -->
    <aside class="sources">
        <h2>Bronnen:</h2>
        <!-- You’ll dynamically inject citations here -->
    </aside>

    <!-- Right 75%: your existing chat -->
    <main class="chat-wrapper">
        <div id="promptButtons" class="prompt-buttons">
            <button>Creëer een lesplan van 50 minuten voor niveau 4 mbo studenten in de opleiding tot watermanager over het thema waterretentie in steden waarbij ten minste een real life casus wordt gebruikt.</button>
            <button>Leg uit wat hitte-eilanden zijn  hoe ze ontstaan en welke oplossingen er evidence based zijn om deze tegen te gaan.</button>
            <button>Maak een onderwijsmodule  over het thema Biodiversiteit met acht onderliggende lessen van 2 uur voor mbo niveau 3 studenten in de opleiding Hovenier</button>
            <button>Beschrijf een opdracht  voor vmbo leerlingen waarbij ze bewust worden van de duurzaamheidsopgaven en zelf aan de slag gaan met het onderzoeken van de manier waarop zij hier aan bij kunnen dragen.</button>
        </div>
        <div id="messages"></div>
        <div class="input-area">
            <textarea id="userInput" rows="1" placeholder="Je vraag of bericht ..."></textarea>
            <button id="sendBtn"></button>
        </div>
    </main>
</div>

<script type="module" src="{{ url_for('static', filename='static.js') }}"></script>
</body>
</html>
